<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pong Game</title>
</head>
<body>
    <canvas id="canvas" width="800" height="600"></canvas>
    <script>
        const canvas = document.getElementById('canvas');
        const context = canvas.getContext('2d');
        const paddleLeft = { x: 50, y: 250, width: 20, height: 100, speed: 300 };
        const paddleRight = { x: 730, y: 250, width: 20, height: 100, speed: 300 };
        const ball = { x: 400, y: 300, radius: 10, velocityX: 0, velocityY: 0 };
        let player1Score = 0;
        let player2Score = 0;
        let gameState = 'start';
        let countdown = 0;
        let lastScorer = 'player1';
        const keysPressed = { w: false, s: false, ArrowUp: false, ArrowDown: false };
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        window.addEventListener('keydown', (e) => {
            if (e.key in keysPressed) keysPressed[e.key] = true;
            if (e.key === ' ' && (gameState === 'start' || gameState === 'gameover')) resetGame();
        });

        window.addEventListener('keyup', (e) => {
            if (e.key in keysPressed) keysPressed[e.key] = false;
        });

        function resetGame() {
            player1Score = 0;
            player2Score = 0;
            paddleLeft.y = 250;
            paddleRight.y = 250;
            resetBall();
            gameState = 'playing';
        }

        function resetBall() {
            ball.x = canvas.width / 2;
            ball.y = canvas.height / 2;
            ball.velocityX = 0;
            ball.velocityY = 0;
            countdown = 3;
        }

        function playSound(frequency, duration) {
            const oscillator = audioCtx.createOscillator();
            oscillator.type = 'square';
            oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime);
            oscillator.connect(audioCtx.destination);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + duration);
        }

        function update(delta) {
            if (gameState !== 'playing') return;
            if (keysPressed.w) paddleLeft.y = Math.max(0, paddleLeft.y - paddleLeft.speed * delta);
            if (keysPressed.s) paddleLeft.y = Math.min(canvas.height - paddleLeft.height, paddleLeft.y + paddleLeft.speed * delta);
            if (keysPressed.ArrowUp) paddleRight.y = Math.max(0, paddleRight.y - paddleRight.speed * delta);
            if (keysPressed.ArrowDown) paddleRight.y = Math.min(canvas.height - paddleRight.height, paddleRight.y + paddleRight.speed * delta);
            if (countdown > 0) {
                countdown -= delta;
                if (countdown <= 0) {
                    ball.velocityX = (lastScorer === 'player1' ? 300 : -300);
                    ball.velocityY = (Math.random() - 0.5) * 200;
                }
                return;
            }
            ball.x += ball.velocityX * delta;
            ball.y += ball.velocityY * delta;
            if (ball.y - ball.radius < 0 || ball.y + ball.radius > canvas.height) {
                ball.velocityY = -ball.velocityY;
                playSound(440, 0.1);
            }
            if (ball.x - ball.radius < paddleLeft.x + paddleLeft.width &&
                ball.y > paddleLeft.y && ball.y < paddleLeft.y + paddleLeft.height) {
                const hitPos = (ball.y - paddleLeft.y) / paddleLeft.height;
                ball.velocityY = (hitPos - 0.5) * 2 * 300;
                ball.velocityX = -ball.velocityX;
                playSound(440, 0.1);
            }
            if (ball.x + ball.radius > paddleRight.x &&
                ball.y > paddleRight.y && ball.y < paddleRight.y + paddleRight.height) {
                const hitPos = (ball.y - paddleRight.y) / paddleRight.height;
                ball.velocityY = (hitPos - 0.5) * 2 * 300;
                ball.velocityX = -ball.velocityX;
                playSound(440, 0.1);
            }
            if (ball.x < 0) {
                player2Score++;
                lastScorer = 'player2';
                playSound(220, 0.2);
                resetBall();
            } else if (ball.x > canvas.width) {
                player1Score++;
                lastScorer = 'player1';
                playSound(220, 0.2);
                resetBall();
            }
            if (player1Score >= 5 || player2Score >= 5) gameState = 'gameover';
        }

        function render() {
            context.fillStyle = 'black';
            context.fillRect(0, 0, canvas.width, canvas.height);
            context.fillStyle = 'white';
            context.font = '40px Arial';
            context.textAlign = 'center';
            if (gameState === 'start') {
                context.fillText('Press Space to Start', canvas.width / 2, canvas.height / 2);
            } else if (gameState === 'gameover') {
                context.fillText('Game Over', canvas.width / 2, canvas.height / 2 - 40);
                context.fillText(`Player ${player1Score > player2Score ? 1 : 2} Wins!`, canvas.width / 2, canvas.height / 2);
                context.fillText('Press Space to Restart', canvas.width / 2, canvas.height / 2 + 40);
            } else {
                for (let y = 10; y < canvas.height; y += 40) context.fillRect(395, y, 10, 20);
                context.fillRect(paddleLeft.x, paddleLeft.y, paddleLeft.width, paddleLeft.height);
                context.fillRect(paddleRight.x, paddleRight.y, paddleRight.width, paddleRight.height);
                context.beginPath();
                context.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
                context.fill();
                context.fillText(player1Score, canvas.width / 4, 50);
                context.fillText(player2Score, 3 * canvas.width / 4, 50);
                if (countdown > 0) context.fillText(Math.ceil(countdown), canvas.width / 2, canvas.height / 2);
            }
        }

        let lastTime = 0;
        function gameLoop(timestamp) {
            const delta = (timestamp - lastTime) / 1000;
            lastTime = timestamp;
            update(delta);
            render();
            requestAnimationFrame(gameLoop);
        }

        resetGame();
        requestAnimationFrame(gameLoop);
    </script>
</body>
</html>
