<!DOCTYPE html>
<html>
<head>
    <title>Retro Platformer</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #000; color: #fff; font-family: 'Press Start 2P', cursive; }
        #game-container { position: relative; width: 800px; height: 600px; margin: 0 auto; background: #1a1a1a; }
        .block { position: absolute; background: #4a4a4a; }
        .player { width: 40px; height: 40px; background: #00ff00; border-radius: 50%; }
        .enemy { width: 30px; height: 30px; background: #ff0000; border-radius: 50%; }
        .coin { width: 20px; height: 20px; background: #ffff00; border-radius: 50%; }
        .hud { position: absolute; top: 10px; left: 10px; font-size: 18px; }
        .game-over { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 36px; display: none; }
    </style>
</head>
<body>
    <div id="game-container">
        <div class="hud" id="hud">Score: 0 | Lives: 3</div>
        <div class="game-over" id="gameOver">GAME OVER<br>Press R to Restart</div>
    </div>

    <script>
        const gameContainer = document.getElementById('game-container');
        const hud = document.getElementById('hud');
        const gameOverScreen = document.getElementById('gameOver');

        const GRAVITY = 0.5;
        const MOVE_SPEED = 5;
        const JUMP_POWER = -12;

        let player = {
            x: 50,
            y: 510, // Fixed initial position to sit on platform [[6]][[8]]
            width: 40,
            height: 40,
            velY: 0,
            onGround: false,
            canJump: true
        };

        let keys = {};
        let score = 0;
        let lives = 3;
        let gameLoop;
        let level = 1;
        let platforms = [];
        let enemies = [];
        let coins = [];

        function initLevel1() {
            platforms = [
                { x: 0, y: 550, width: 800, height: 50 }, // Main floor
                { x: 200, y: 450, width: 200, height: 20 },
                { x: 500, y: 350, width: 150, height: 20 }
            ];

            enemies = [
                { x: 300, y: 520, width: 30, height: 30, direction: 1, speed: 2 }
            ];

            coins = [
                { x: 250, y: 410, collected: false },
                { x: 550, y: 310, collected: false }
            ];
        }

        function update() {
            // Player movement
            if (keys['ArrowRight']) player.x += MOVE_SPEED;
            if (keys['ArrowLeft']) player.x -= MOVE_SPEED;
            
            // Gravity system [[7]]
            player.velY += GRAVITY;
            player.y += player.velY;
            player.onGround = false;

            // Platform collision detection [[6]]
            platforms.forEach(platform => {
                if (player.x < platform.x + platform.width &&
                    player.x + player.width > platform.x &&
                    player.y + player.height > platform.y &&
                    player.y < platform.y + platform.height) {
                    
                    if (player.velY > 0 && player.y < platform.y) {
                        player.y = platform.y - player.height;
                        player.velY = 0;
                        player.onGround = true;
                        player.canJump = true;
                    }
                }
            });

            // Jump mechanics
            if (keys['Space'] && player.canJump && player.onGround) {
                player.velY = JUMP_POWER;
                player.canJump = false;
            }

            // Enemy AI and collision
            enemies.forEach(enemy => {
                enemy.x += enemy.speed * enemy.direction;
                if (enemy.x + enemy.width > 800 || enemy.x < 0) enemy.direction *= -1;

                if (player.x < enemy.x + enemy.width &&
                    player.x + player.width > enemy.x &&
                    player.y < enemy.y + enemy.height &&
                    player.y + player.height > enemy.y) {
                    lives--;
                    resetPlayer();
                }
            });

            // Coin collection
            coins.forEach(coin => {
                if (!coin.collected &&
                    player.x < coin.x + 20 &&
                    player.x + player.width > coin.x &&
                    player.y < coin.y + 20 &&
                    player.y + player.height > coin.y) {
                    coin.collected = true;
                    score += 100;
                }
            });

            // Boundary checks
            if (player.x < 0) player.x = 0;
            if (player.x + player.width > 800) player.x = 800 - player.width;

            // Level progression
            if (coins.every(c => c.collected)) {
                level++;
                initLevel();
            }

            // HUD update
            hud.textContent = `Score: ${score} | Lives: ${lives}`;

            // Game over condition
            if (lives <= 0) gameOver();
        }

        function draw() {
            gameContainer.innerHTML = `<div class="hud">${hud.textContent}</div>`;
            
            // Draw platforms
            platforms.forEach(platform => {
                const div = document.createElement('div');
                div.className = 'block';
                div.style.left = platform.x + 'px';
                div.style.top = platform.y + 'px';
                div.style.width = platform.width + 'px';
                div.style.height = platform.height + 'px';
                gameContainer.appendChild(div);
            });

            // Draw player
            const playerDiv = document.createElement('div');
            playerDiv.className = 'player';
            playerDiv.style.left = player.x + 'px';
            playerDiv.style.top = player.y + 'px';
            gameContainer.appendChild(playerDiv);

            // Draw enemies
            enemies.forEach(enemy => {
                const enemyDiv = document.createElement('div');
                enemyDiv.className = 'enemy';
                enemyDiv.style.left = enemy.x + 'px';
                enemyDiv.style.top = enemy.y + 'px';
                gameContainer.appendChild(enemyDiv);
            });

            // Draw coins
            coins.forEach(coin => {
                if (!coin.collected) {
                    const coinDiv = document.createElement('div');
                    coinDiv.className = 'coin';
                    coinDiv.style.left = coin.x + 'px';
                    coinDiv.style.top = coin.y + 'px';
                    gameContainer.appendChild(coinDiv);
                }
            });
        }

        function gameLoop() { update(); draw(); }

        function resetPlayer() {
            player.x = 50;
            player.y = 510; // Match platform height [[8]]
            player.velY = 0;
        }

        function gameOver() {
            clearInterval(gameLoop);
            gameOverScreen.style.display = 'block';
        }

        function restartGame() {
            score = 0;
            lives = 3;
            level = 1;
            gameOverScreen.style.display = 'none';
            initLevel();
            gameLoop = setInterval(gameLoop, 16);
        }

        function initLevel() {
            switch(level) {
                case 1: initLevel1(); break;
                default: alert('You win!'); gameOver();
            }
        }

        // Input handling
        document.addEventListener('keydown', e => {
            keys[e.key] = true;
            if (e.key === 'r' && lives <= 0) restartGame();
        });
        document.addEventListener('keyup', e => { keys[e.key] = false; });

        // Start game
        initLevel();
        gameLoop = setInterval(gameLoop, 16);
    </script>
</body>
</html>
